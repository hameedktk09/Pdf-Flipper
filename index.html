<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D PDF Book Viewer</title>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js";
</script>

<style>
:root {
    --book-width: 440px;
    --book-height: 580px;
    --bg-color: #abb1bb;
    --inner-gap: 8px;
    --tray-color: #64748b;
}

body {
    background-color: var(--bg-color);
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
    margin: 0;
    font-family: sans-serif;
    overflow: hidden;
}

.tray {
    position: relative;
    padding: 10px 15px;
    background: var(--tray-color);
    border-radius: 6px;
    box-shadow: inset 0 2px 10px rgba(0,0,0,0.3), 0 15px 30px rgba(0,0,0,0.2);
}

#controls {
    position: absolute;
    left: 10px;
    top: 10px;
    z-index: 7000;
    background: rgba(255,255,255,0.9);
    padding: 8px;
    border-radius: 4px;
}

.loading {
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    color:white;
    font-size:18px;
    display:none;
}

.book-wrapper {
    position: relative;
    width: calc((var(--book-width) * 2) + var(--inner-gap));
    height: var(--book-height);
    perspective: 2500px;
}

.gutter-gap {
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    width:var(--inner-gap);
    height:100%;
    background:linear-gradient(to right, rgba(0,0,0,.2), rgba(255,255,255,.4), rgba(0,0,0,.2));
}

.page {
    position:absolute;
    width:var(--book-width);
    height:var(--book-height);
    right:0;
    transform-origin:left center;
    transform-style:preserve-3d;
    transition:transform .8s cubic-bezier(.645,.045,.355,1);
    cursor:pointer;
}

.page-face {
    position:absolute;
    width:100%;
    height:100%;
    background:white;
    backface-visibility:hidden;
}

.back { transform:rotateY(180deg); background:#f0f0f0; }
.page.flipped { transform:rotateY(-180deg) translateX(calc(var(--inner-gap)*-1)); }

canvas { width:100%; height:100%; }

.nav-btn {
    position:fixed;
    top:50%;
    transform:translateY(-50%);
    background:rgba(255,255,255,.3);
    border:none;
    width:35px;
    height:70px;
    cursor:pointer;
    font-size:26px;
}
#prevBtn { left:5px; }
#nextBtn { right:5px; }
</style>
</head>

<body>

<button class="nav-btn" id="prevBtn">&#10094;</button>
<button class="nav-btn" id="nextBtn">&#10095;</button>

<div class="tray">
    <div id="controls">
        <b>Select Book</b><br>
        <select id="pdfSelect">
            <option value="">-- Choose --</option>
            <option value="pdf/4th Symposium 2026 Report.pdf">4th Symposium Report</option>
        </select>
    </div>

    <div class="loading" id="loading">Loading PDF...</div>

    <div class="book-wrapper">
        <div id="book-pages"></div>
        <div class="gutter-gap"></div>
    </div>
</div>

<script>
const bookContainer = document.getElementById('book-pages');
const pdfSelect = document.getElementById('pdfSelect');
const loading = document.getElementById('loading');

let pages = [];
let currentPagePair = -1;

pdfSelect.addEventListener('change', async e=>{
    if(!e.target.value) return;
    loading.style.display="block";
    const res = await fetch(e.target.value);
    const data = await res.arrayBuffer();
    await renderPDF(data);
    loading.style.display="none";
});

async function renderPDF(data){
    const pdf = await pdfjsLib.getDocument(new Uint8Array(data)).promise;
    bookContainer.innerHTML='';
    pages=[];
    currentPagePair=-1;

    for(let i=1;i<=pdf.numPages;i+=2){
        const pageEl=document.createElement('div');
        pageEl.className='page';
        pageEl.style.zIndex=pdf.numPages-i;

        const front=await createFace(pdf,i,'front');
        const back=(i+1<=pdf.numPages)?await createFace(pdf,i+1,'back'):blank();

        pageEl.appendChild(front);
        pageEl.appendChild(back);
        pageEl.onclick=()=>flipToPage(pages.indexOf(pageEl));

        bookContainer.appendChild(pageEl);
        pages.push(pageEl);
    }
}

async function createFace(pdf,num,type){
    const face=document.createElement('div');
    face.className='page-face '+type;

    const canvas=document.createElement('canvas');
    const page=await pdf.getPage(num);
    const viewport=page.getViewport({scale:2});
    canvas.width=viewport.width;
    canvas.height=viewport.height;

    await page.render({canvasContext:canvas.getContext('2d'),viewport}).promise;
    face.appendChild(canvas);
    return face;
}

function blank(){
    const d=document.createElement('div');
    d.className='page-face back';
    d.style.background='#e5e7eb';
    return d;
}

function flipToPage(index){
    if(index>currentPagePair){
        for(let i=currentPagePair+1;i<=index;i++){
            pages[i].classList.add('flipped');
            pages[i].style.zIndex=100+i;
        }
    } else {
        for(let i=currentPagePair;i>index;i--){
            pages[i].classList.remove('flipped');
            pages[i].style.zIndex=pages.length-i;
        }
    }
    currentPagePair=index;
}

nextBtn.onclick=()=>{ if(currentPagePair<pages.length-1) flipToPage(currentPagePair+1); };
prevBtn.onclick=()=>{ if(currentPagePair>=0) flipToPage(currentPagePair-1); };
</script>

</body>
</html>
