<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>3D PDF Flipper Â· drkhan Edition</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --book-width: 480px; --book-height: 680px;         
      --bg-color: #f8fafc; --spine-color: #1e3a8a;
      --inner-gap: 8px; --page-speed: 0.8s;
      --cover-bg: #f8f4e9; --button-blue: #1e3a8a;
      --text-color: #0f172a; --accent: #a3e635;
      --panel-bg: rgba(255,255,255,0.05); --border-color: rgba(0,0,0,0.1);
      --gutter-shadow: rgba(0, 0, 0, 0.12); 
      --cover-thickness: 1px 1px 0px #c4c4c4, 2px 2px 0px #c4c4c4, 3px 3px 0px #c4c4c4, 4px 4px 5px rgba(0,0,0,0.2);
      --neon-glow: 0 0 10px rgba(163, 230, 53, 0.3);
    }
    body.dark-mode {
      --bg-color: #0f172a; --spine-color: #334155;
      --cover-bg: #2d2f31; --text-color: #f1f5f9;
      --panel-bg: rgba(255,255,255,0.05); --border-color: rgba(255,255,255,0.1);
      --gutter-shadow: rgba(0, 0, 0, 0.4); 
      --cover-thickness: 1px 1px 0px #111, 2px 2px 0px #111, 3px 3px 0px #111, 4px 4px 8px rgba(0,0,0,0.5);
    }
    body { background-color: var(--bg-color); display: flex; align-items: center; justify-content: center; min-height: 100vh; font-family: 'Inter', sans-serif; overflow: hidden; touch-action: none; }
    
    .book-header-tray {
      position: absolute; top: 0; left: 0; right: 0; height: 50px;
      background: var(--panel-bg); display: flex; align-items: center;
      justify-content: center; padding: 0 15px; gap: 12px;
      border-bottom: 1px solid var(--border-color);
      z-index: 5; backdrop-filter: blur(4px);
    }
    
    .book-header-tray::before {
      content: ""; position: absolute; left: 0; top: 0; bottom: 0; width: 1px; background: var(--border-color);
    }

    .tray-btn { background: var(--button-blue); color: white; border: none; padding: 0 12px; border-radius: 6px; cursor: pointer; font-size: 14px; height: 28px; transition: 0.2s; font-weight: 500; }
    select { background: white; border: 1px solid #cbd5e1; padding: 0 8px; border-radius: 6px; cursor: pointer; font-size: 12px; height: 28px; min-width: 140px; color: #334155; }

    .status-box { display: flex; align-items: center; gap: 6px; font-size: 11px; font-weight: 700; color: var(--text-color); }
    .status-light { width: 8px; height: 8px; border-radius: 50%; background: #94a3b8; }
    .status-light.active { background: #fbbf24; box-shadow: 0 0 8px #fbbf24; }

    .book-container { position: relative; width: calc((var(--book-width) * 2) + var(--inner-gap)); height: var(--book-height); perspective: 2800px; }
    .cover-spine { position: absolute; left: 50%; transform: translateX(-50%); width: 16px; top: 0; height: 100%; background: var(--spine-color); z-index: 45; opacity: 0; transition: opacity 0.3s; pointer-events: none; border-radius: 2px; }
    .cover-spine.visible { opacity: 1; }
    
    .page { position: absolute; width: var(--book-width); height: var(--book-height); right: 0; transform-origin: left center; transform-style: preserve-3d; transition: transform var(--page-speed) cubic-bezier(0.23, 1, 0.32, 1); cursor: pointer; }
    
    .page-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; background: white; border: 1px solid #e2e8f0; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; overflow: hidden; border-radius: 2px 8px 8px 2px; padding-top: 60px; z-index: 1; }
    body.dark-mode .page-face { background: #1e293b; border-color: #334155; }
    
    .front::after { content: ""; position: absolute; top: 0; left: 0; width: 35px; height: 100%; background: linear-gradient(to right, var(--gutter-shadow), transparent); pointer-events: none; z-index: 10; }
    .back::after { content: ""; position: absolute; top: 0; right: 0; width: 35px; height: 100%; background: linear-gradient(to left, var(--gutter-shadow), transparent); pointer-events: none; z-index: 10; }
    
    .cover-page { background: var(--cover-bg) !important; color: var(--text-color); border-width: 2px; }
    .back { transform: rotateY(180deg); }
    .page.flipped { transform: rotateY(-180deg) translateX(calc(var(--inner-gap) * -1)); }
    
    canvas { width: 100%; height: 100%; object-fit: contain; }

    .cover-logo-main { width: 140px; margin-top: 40px; margin-bottom: 20px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); animation: float 3s ease-in-out infinite; }
    .back-cover-logo { width: 120px; margin-top: 60px; }
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
    
    .cover-footer { 
      position: absolute; bottom: 30px; font-size: 12px; font-weight: 600; 
      display: flex; align-items: center; gap: 10px; color: var(--text-color);
      padding: 6px 15px; border: 1px solid var(--accent); border-radius: 20px;
      background: var(--panel-bg); box-shadow: var(--neon-glow);
      z-index: 20;
    }
    .footer-logo-small { width: 18px; height: 18px; mix-blend-mode: multiply; }
    body.dark-mode .footer-logo-small { mix-blend-mode: screen; filter: brightness(1.2); }
  </style>
</head>
<body onclick="handleStart()">

<div class="book-container">
    <div class="cover-spine" id="coverSpine"></div>
    <div class="book-wrapper" id="book-pages"></div>
</div>

<audio id="flipSound" src="https://www.soundjay.com/misc/sounds/paper-flip-1.mp3" preload="auto"></audio>

<script>
    let localFileMap = {};
    let appStarted = false;
    let pages = []; let currentPagePair = -1;
    let currentActiveFile = "";
    const bookContainer = document.getElementById('book-pages');
    const coverSpine = document.getElementById('coverSpine');
    const flipSound = document.getElementById('flipSound');

    const pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

    function getHeaderTrayHTML(percentage = null, selectedFileName = "") {
        const activeFile = selectedFileName || currentActiveFile;
        const options = Object.keys(localFileMap).length 
            ? Object.keys(localFileMap).sort().map(n => {
                const selected = n === activeFile ? 'selected' : '';
                return `<option value="${n}" ${selected}>${n}</option>`;
            }).join('') 
            : '<option value="">ðŸ“‚ Link Folder</option>';

        const statusText = percentage !== null ? `LOADING ${percentage}%` : 'LOADING';
        const lightClass = percentage === 100 ? 'status-light' : 'status-light active';
        const lightStyle = (percentage === 100 || percentage === null) ? 'background: var(--accent);' : 'background: #fbbf24; box-shadow: 0 0 8px #fbbf24;';

        return `
        <div class="book-header-tray">
            <select class="pdf-select-inner">${options}</select>
            <button class="tray-btn dark-toggle-inner">ðŸŒ™</button>
            <div class="status-box">
                <div class="${lightClass}" style="${lightStyle}"></div>
                <span class="status-text-label">${statusText}</span>
            </div>
        </div>`;
    }

    function handleStart() { if (appStarted) return; appStarted = true; }

    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        const btn = document.querySelector('.dark-toggle-inner');
        if (btn) btn.innerText = document.body.classList.contains('dark-mode') ? 'â˜€ï¸' : 'ðŸŒ™';
    }

    document.addEventListener('keydown', (e) => {
        if (!appStarted) return;
        if (e.target.tagName === 'SELECT' || e.target.tagName === 'INPUT') return;
        switch(e.key) {
            case "ArrowRight": case " ": 
                if (currentPagePair < pages.length - 1) flipToPage(currentPagePair + 1);
                break;
            case "ArrowLeft":
                if (currentPagePair >= 0) flipToPage(currentPagePair - 1);
                break;
            case "d": case "D":
                toggleDarkMode();
                break;
        }
    });

    document.addEventListener('click', async (e) => {
        if (e.target.classList.contains('dark-toggle-inner')) toggleDarkMode();
        if (e.target.classList.contains('pdf-select-inner') && Object.keys(localFileMap).length === 0) await linkFolder();
    });

    document.addEventListener('change', (e) => {
        if (e.target.classList.contains('pdf-select-inner') && e.target.value !== "") {
            loadLocalPDF(e.target.value);
        }
    });

    async function linkFolder() {
        try {
            const dirHandle = await window.showDirectoryPicker();
            localFileMap = {};
            for await (const entry of dirHandle.values()) {
                if (entry.kind === 'file' && entry.name.toLowerCase().endsWith('.pdf')) {
                    localFileMap[entry.name] = await entry.getFile();
                }
            }
            const files = Object.keys(localFileMap).sort();
            if (files.length > 0) loadLocalPDF(files[0]);
        } catch (err) {}
    }

    function flipToPage(index) {
        flipSound.currentTime = 0; flipSound.play().catch(()=>{});
        pages.forEach((p, i) => {
            if (i <= index) { p.classList.add('flipped'); setTimeout(() => { p.style.zIndex = 100 + i; }, 200); }
            else { p.classList.remove('flipped'); p.style.zIndex = pages.length - i; }
        });
        currentPagePair = index;
        (currentPagePair === -1 || currentPagePair === pages.length - 1) ? coverSpine.classList.add('visible') : coverSpine.classList.remove('visible');
    }

    function createFace(cls, html) { 
        const d = document.createElement('div'); 
        d.className = cls; 
        d.innerHTML = html; 
        return d; 
    }

    function showDefaultCover() {
        bookContainer.innerHTML = ''; pages = [];
        const tray = getHeaderTrayHTML();
        const p1 = document.createElement('div'); p1.className = 'page'; p1.style.zIndex = 10;
        p1.appendChild(createFace('page-face front cover-page', tray + `<img src="HRK-Logo.JFIF" class="cover-logo-main"><h1>PDF-Flipper</h1><h2>drkhan Edition</h2><div class="cover-footer">drkhan | <img src="HRK-Logo.JFIF" class="footer-logo-small"> Â© 2026</div>`));
        p1.appendChild(createFace('page-face back inner-page', tray + '<div style="margin:auto; text-align:center; opacity:0.6;"><h3>Welcome</h3><p>Click "Link Folder" or use <b>Arrow Keys</b> to navigate.</p></div>'));
        p1.onclick = (e) => handleFlip(e, p1);
        bookContainer.appendChild(p1); pages.push(p1);

        const p2 = document.createElement('div'); p2.className = 'page'; p2.style.zIndex = 5;
        p2.appendChild(createFace('page-face front inner-page', tray + '<div style="margin:auto">End of Preview</div>'));
        p2.appendChild(createFace('page-face back cover-page', tray + `<img src="HRK-Logo.JFIF" class="back-cover-logo"><div class="cover-footer">drkhan | <img src="HRK-Logo.JFIF" class="footer-logo-small"> Â© 2026</div>`));
        p2.onclick = (e) => handleFlip(e, p2);
        bookContainer.appendChild(p2); pages.push(p2);
        flipToPage(-1);
    }

    async function loadLocalPDF(fileName) {
        currentActiveFile = fileName;
        bookContainer.innerHTML = ''; pages = [];
        const file = localFileMap[fileName];
        const buffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;

        const draw = async (num, face) => {
            const pg = await pdf.getPage(num); 
            const v = pg.getViewport({ scale: 1.3 });
            const canvas = document.createElement('canvas'); 
            canvas.width = v.width; canvas.height = v.height;
            await pg.render({ canvasContext: canvas.getContext('2d'), viewport: v }).promise;
            face.appendChild(canvas);
        };

        const cp = document.createElement('div'); cp.className = 'page'; cp.style.zIndex = pdf.numPages + 100;
        cp.appendChild(createFace('page-face front cover-page', getHeaderTrayHTML(0, fileName) + `<img src="HRK-Logo.JFIF" class="cover-logo-main" style="width:60px; margin-top:20px;"><h3>${fileName}</h3>`));
        cp.appendChild(createFace('page-face back inner-page', getHeaderTrayHTML(0, fileName) + '<div style="margin:auto">Document Start</div>'));
        cp.onclick = (e) => handleFlip(e, cp);
        bookContainer.appendChild(cp); pages.push(cp);

        for (let i = 1; i <= pdf.numPages; i += 2) {
            let progress = Math.round((i / pdf.numPages) * 100);
            const p = document.createElement('div'); p.className = 'page'; p.style.zIndex = pdf.numPages - i;
            const f = createFace('page-face front inner-page', getHeaderTrayHTML(progress, fileName));
            const b = createFace('page-face back inner-page', getHeaderTrayHTML(progress, fileName));
            
            await draw(i, f);
            if (i + 1 <= pdf.numPages) {
                await draw(i + 1, b);
            } else {
                b.innerHTML = getHeaderTrayHTML(progress, fileName) + '<div style="margin:auto; opacity:0.3;">[ End of Content ]</div>';
            }

            p.appendChild(f); p.appendChild(b);
            p.onclick = (e) => handleFlip(e, p);
            bookContainer.appendChild(p); pages.push(p);
        }

        const bc = document.createElement('div'); bc.className = 'page'; bc.style.zIndex = 0;
        bc.appendChild(createFace('page-face front inner-page', getHeaderTrayHTML(100, fileName) + '<div style="margin:auto">Thank You</div>'));
        bc.appendChild(createFace('page-face back cover-page', getHeaderTrayHTML(100, fileName) + `<img src="HRK-Logo.JFIF" class="back-cover-logo"><div class="cover-footer">drkhan | <img src="HRK-Logo.JFIF" class="footer-logo-small"> Â© 2026</div>`));
        bc.onclick = (e) => handleFlip(e, bc);
        bookContainer.appendChild(bc); pages.push(bc);

        flipToPage(-1);
    }

    function handleFlip(e, el) {
        if (e.target.closest('.book-header-tray')) return; 
        const rect = el.getBoundingClientRect();
        if ((e.clientX - rect.left) > rect.width / 2) { if (currentPagePair < pages.length - 1) flipToPage(currentPagePair + 1); }
        else { if (currentPagePair >= 0) flipToPage(currentPagePair - 1); }
    }

    showDefaultCover();
</script>
</body>
</html>